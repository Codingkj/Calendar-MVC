<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>KK Calendar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="stylesheet.css">

  <script src="http://code.jquery.com/jquery-2.1.4.min.js"> </script>
  <link rel="stylesheet" href="http://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
  <link rel="stylesheet" href="../../jquery-ui-1.11.4/jquery-ui.css">
  <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
  <script src="../../jquery-ui-1.11.4/jquery-ui.js"></script>
  
  <script src="View.js"></script>
  <script src="ViewForms.js"></script>
  <script src="ViewEvents.js"></script>
  <script src="Model.js"></script>
  <script src="Utilities.js"></script>

</head>
<body>

 <script src="http://maps.googleapis.com/maps/api/js?v=3.exp&sensor=true">
   </script>
  <script>


$(function controllerSupremo(){  
    var dateSelected = "";  
    var $bodyElement = $('body');
    var $gridElement = $('#grid');
    var currentMonthNumber = Utilities.getCurrentMonthNumber();
    var currentMonthName = Utilities.getMonthName(currentMonthNumber); 
    var currentYearNumber = Utilities.getYearNumber(); 
    View.createPageHeader(currentMonthName, currentYearNumber,$bodyElement);
    View.createGridOfDatesView($bodyElement);
    Model.createWeekdayLabelCells($gridElement);
   // createInitialPageView(currentMonthName);

    var $dayHeaderCells = Model.getWeekdayCells();
    var $weekdayLabels = Model.getWeekdayLabels();

    View.setWeekdayLabelsToColumns($dayHeaderCells, $weekdayLabels);
    var numDaysInMonth = Utilities.getDatesInCurrentMonth(currentYearNumber,currentMonthNumber);
    var locationsArray= [];
    var taskEntryArray = Model.initialiseTaskStorageArray(numDaysInMonth);
    Model.initialiseLocationsStorageArray(locationsArray);
    
    var startCell = new Date(currentMonthName+' 1, 2015 00:00:00').getDay();
    var daysToUse = Model.setBlanksAtStartOfMonth(currentMonthName,startCell); 
    var daysToUseWithBlanksAdded = Model.setNumbersToRestOfMonth(currentMonthName,daysToUse,numDaysInMonth,startCell);   
    View.setArrayValuesToTablePosition(daysToUseWithBlanksAdded,$gridElement);   
    
    var dateToHighlight = Utilities.findTodaysDate(); 
    var calendarCell = Model.getTodayCell(dateToHighlight);  
    View.setTodayHighlight(dateToHighlight,calendarCell);
    ViewForms.createTaskEntryForm($bodyElement);
    ViewForms.createTaskEditForm($bodyElement);
    ViewForms.createMapView($bodyElement);
  //  addMarksToSlider();
  
// $( "button" ).on( "click", {  name: "Karl"}, greet );

    $('.todaysdate').on('click',{},ViewEvents.showClickedOnDate);
    $('.active').on('click',{},ViewEvents.showClickedOnDate);
    $('#submitbutton').on('click',{},ViewEvents.saveTaskEntry);
    $('#cancelbutton').on('click',{},ViewEvents.cancelTaskEntry);
    $('#closebutton').on('click',{},ViewEvents.closeEditForm);  
    $('#editbutton').on('click',{},ViewEvents.showEditForm);
    $('#removebutton').on('click',{},ViewEvents.removeTask); 
    $('#gobackbutton').on('click',{},ViewEvents.returnToCalendarScreen);
    $( "#findbutton" ).on('click',{},ViewEvents.findPostcode);


    $("#mapViewButton").click(function () {   // to display all tasks on 1 map
        event.preventDefault(); 
        event.stopPropagation();
        console.log("got here too!!!!");
        View.showMapView;
        View.displayStarterMap;
      
        $ (function createSlider()  {
        
        $("#slider-range").slider({
          range: true,
          min: 1,
          max: 30,       //should be days in the month
          values:[1,20], 
          step:1,
      
            slide: function onSliderMove( event, ui ) {
                      $( "#slidevalue" ).val(ui.values[ 0 ] + " - " + ui.values[ 1 ] + ' '+ currentMonthName);
                   },
            start: function( event, ui ) {
                      $( "#startvalue" ).val(ui.values[ 0 ] + " - " + ui.values[ 1 ] );
                   },
            stop: function onSliderStop( event, ui ) {
                    View.clearTasksInSliderView();

                    $( "#stopvalue" ).val(ui.values[ 0 ] + " - " + ui.values[ 1 ] ); 
                      
                        var marker; 
                        var i;
                        var tkCount=0;
                        var infowindow = new google.maps.InfoWindow();
                                    
                        for (var iterator=ui.values[0];iterator<ui.values[1]; iterator++){
                            if (taskEntries[iterator]!==""){
                                tkCount=tkCount+1;
                            }
                        }
                        $lineBr=$('<br></br>');
                        $taskDiv.append($lineBr);
                        $taskCount=$('<p>There are '+ tkCount +' tasks in this range:</p>');
                        $taskDiv.append($taskCount);

                        for (var iterator=ui.values[0];iterator<ui.values[1]; iterator++){
                            marker = new google.maps.Marker({
                                position: new google.maps.LatLng(locationsArray[iterator][0], locationsArray[iterator][1]),
                                map: map
                                });

                            if (taskEntries[iterator]!==""){
                                var numTasks=numTasks+1;
                                $textBox4=$('<div id="textBox4"></div>');
                                $ptext4=$('<p></p>').val="";
                                console.log("task text",taskEntries[iterator]);
                                $lineBr=$('<br></br>'); 
                                $textBox4.append(iterator," Nov: ",taskEntries[iterator]).append($lineBr);
                                $taskDiv.append($textBox4);  
                                $taskDiv.append($lineBr);
                                $taskDiv.append($lineBr);
                                }

                            google.maps.event.addListener(marker, 'click', (function(marker, i) {
                                    return function() {
                                      infowindow.setContent(taskEntries[iterator]);
                                      infowindow.open(map, marker);
                                }
                            })(marker, iterator));
                        }   //end of for loop
                          
                    },  //end of slider stop function
                }); //end of .slider function
         
      });  //end of  slider functionality function call
    });  //end of mapView


});

</script>
</body>
</html>